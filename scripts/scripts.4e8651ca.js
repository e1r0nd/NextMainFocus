angular.module("nextmainfocusApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","LocalStorageModule","pascalprecht.translate","ng-sortable"]).config(["$routeProvider",function(a){"use strict";a.when("/view/:view",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).otherwise({redirectTo:"/view/items"})}]).config(["localStorageServiceProvider",function(a){"use strict";a.setPrefix("nmf")}]).config(["$translateProvider",function(a){"use strict";a.translations("en",{APP_TITLE:"Next Main Focus",MENU_PROJECTS:"Projects",MENU_TASKS:"Tasks",MENU_FOCUS:"Focus",ITEM_TITLE:"Title",ITEM_ACRONYM:"Acronym",ITEM_DATE:"Date",ITEM_PARENTID:"Project",ITEM_CLOSE:"Close",ITEM_SAVE_CHANGES:"Save changes",ITEM_REMOVE:"Remove item",ITEMS_EMPTY:"Nothing to show in this list",ITEM_NOT_EMPTY:"Should be not empty",CONFIRM_QUESTION:"Are you shure?",SEARCH_FOR:"Search for..."}),a.translations("ru",{APP_TITLE:"Основной фокус",MENU_PROJECTS:"Проекты",MENU_TASKS:"Задачи",MENU_FOCUS:"Фокус",ITEM_TITLE:"Название",ITEM_ACRONYM:"Акроним",ITEM_PARENTID:"Проект",ITEM_DATE:"Дата",ITEM_CLOSE:"Закрыть",ITEM_SAVE_CHANGES:"Сохранить",ITEM_REMOVE:"Удалить элемент",ITEMS_EMPTY:"Нечего показывать в этом списке",ITEM_NOT_EMPTY:"Должно быть не пустым",CONFIRM_QUESTION:"Вы уверены?",SEARCH_FOR:"Найти..."}),a.preferredLanguage("en"),a.useSanitizeValueStrategy("escape"),a.useCookieStorage()}]).filter("object2Array",function(){"use strict";return function(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&c.push(a[b]);return c}}).filter("asDate",function(){"use strict";return function(a){return new Date(a)}}),angular.module("nextmainfocusApp").controller("MainCtrl",["$scope","$rootScope","$filter","$translate","localStorageService",function(a,b,c,d,e){"use strict";var f=function(b){var c;try{for(c in a.items)if(a.items.hasOwnProperty(c)&&b===a.items[c].index)return c}catch(d){window.console&&window.console.error&&console.error(d,d.stack)}},g=function(){var b,c,d={"<":"&lt;",">":"&gt;"},e=function(a){try{return d[a]||a}catch(b){window.console&&window.console.error&&console.error(b,b.stack)}};try{for(b in a.items)if(a.items.hasOwnProperty(b))for(c in a.items[b])a.items[b].hasOwnProperty(c)&&(a.items[b][c]=String(a.items[b][c]).replace(/[&<>]/g,e))}catch(f){window.console&&window.console.error&&console.error(f,f.stack)}},h=function(b){var d,g,h;try{if(!b){h=c("orderBy")(c("filter")(a.items,{type:"task"}),"order");for(d in h)h.hasOwnProperty(d)&&(g=f(h[d].index),a.items[g].order=d)}e.set("items",a.items),a.$root.$broadcast("reloadItems")}catch(i){window.console&&window.console.error&&console.error(i,i.stack)}},i=e.get("items");if(a.items=i||[],a.removeItemDialog=function(b){try{a.index=b}catch(c){window.console&&window.console.error&&console.error(c,c.stack)}},a.removeItem=function(b){try{a.items.splice(f(b),1),h(),a.confirmRemove.modal("hide")}catch(c){window.console&&window.console.error&&console.error(c,c.stack)}},a.addItem=function(){try{a.items.push(a.item),a.item=""}catch(b){window.console&&window.console.error&&console.error(b,b.stack)}},a.newItem=function(d){try{a.item={},a.isEmpty=!0,a.item.type=d?"project":"task",a.item.parentID=b.projectItems[0].index,a.itemTitleHelper.html(c("translate")("ITEM_NOT_EMPTY")),["Title","Date","Acronym","Details"].forEach(function(a){$("#item"+a+"Div").addClass("is-empty")})}catch(e){window.console&&window.console.error&&console.error(e,e.stack)}},a.revertItem=function(b){try{a.isEmpty||(a.items[f(b)]=a.originalItem,a.index=null,a.originalItem=null,h()),$(".has-error, .is-empty").removeClass("has-error is-empty")}catch(c){window.console&&window.console.error&&console.error(c,c.stack)}},a.editItem=function(b,c){try{a.isEmpty=!1,$(".is-empty").removeClass("is-empty"),a.item=b,a.originalItem=angular.extend({},b),a.index=c}catch(d){window.console&&window.console.error&&console.error(d,d.stack)}},a.saveEdits=function(b,d){try{if(a.isError=!1,["Title"].forEach(function(d){b[d.toLowerCase()]||a.isError||(b.title||a.itemTitleHelper.html(c("translate")("ITEM_NOT_EMPTY")),a["item"+d].focus(),a["item"+d+"Div"].addClass("has-error"),a.isError=!0)}),a.isError)return;a.addNew.modal("hide"),b.index=Date.now(),"task"===b.type&&(b.acronym=a.items[f(b.parentID)].acronym),a.items[f(d)]&&a.items[f(d)].type!==b.type&&(b.order=String(c("filter")(a.items,{type:"task"}).length)),a.isEmpty?a.addItem():(a.items[f(d)]=b,a.index=null),g(),h(!a.isEmpty)}catch(e){window.console&&window.console.error&&console.error(e,e.stack)}},a.sortableItemList={delay:0,animation:150,handle:".item-itm-tag",onUpdate:function(b){var c,d;try{for(c in b.models)b.models.hasOwnProperty(c)&&(d=f(b.models[c].index),a.items[d].order=c);h(!0)}catch(e){window.console&&window.console.error&&console.error(e,e.stack)}}},a.clearDateInp=function(){a.item.date=""},null===i)try{a.items=[{title:"Project A",date:"2016-06-12",index:"0001",order:"0",type:"project",parentID:"0001",acronym:"PRA",details:""},{title:"Project B",date:"",index:"0002",order:"1",type:"project",parentID:"0002",acronym:"PRB",details:""},{title:"Task 1",date:"2016-06-15",index:"0003",order:"0",type:"task",parentID:"0001",acronym:"PRA",details:"Some details here"},{title:"Task 2",date:"",index:"0004",order:"3",type:"task",parentID:"0001",acronym:"PRA",details:"Lorem epsilum est dollar set amet?"},{title:"Task A",date:"",index:"0005",order:"4",type:"task",parentID:"0001",acronym:"PRA",details:""},{title:"Point 1",date:"",index:"0006",order:"5",type:"task",parentID:"0002",acronym:"PRB",details:"This is the best one"},{title:"Point 2",date:"",index:"0005",order:"6",type:"task",parentID:"0002",acronym:"PRB",details:"The cat-item"}],h(!0)}catch(j){window.console&&window.console.error&&console.error(j,j.stack)}try{$("document").ready(function(){a.addNew=$("#addNew"),a.addBtn=$("#addBtn"),a.confirmRemove=$("#confirmRemove"),a.itemDate=$("#itemDate"),a.itemTitleHelper=$("#itemTitleHelper"),a.itemTitle=$("#itemTitle"),a.itemTitleDiv=$("#itemTitleDiv"),a.itemAcronym=$("#itemAcronym"),a.itemAcronymDiv=$("#itemAcronymDiv"),a.itemParent=$("#itemParent"),a.itemParentDiv=$("#itemParentDiv"),a.itemDescription=$("#itemDescription"),a.itemDescriptionDiv=$("#itemDescriptionDiv"),a.itemType=$("#itemType"),a.itemTypeDiv=$("#itemTypeDiv"),a.itemToggler=$("#itemToggler"),b.togglebuttonBtn=$(".togglebutton-btn");try{a.addNew.on("show.bs.modal",function(){a.addBtn.fadeOut(),$(".togglebutton .toggle").length>1?a.itemToggler.hide():a.itemToggler.show()}).on("hide.bs.modal",function(){a.addBtn.fadeIn()}),a.itemDate.bootstrapMaterialDatePicker({format:"YYYY-MM-DD",lang:d.use(),weekStart:1,time:!1,nowButton:!0})}catch(c){window.console&&window.console.error&&console.error(c,c.stack)}})}catch(k){window.console&&window.console.error&&console.error(k,k.stack)}}]),angular.module("nextmainfocusApp").controller("MenuCtrl",["$scope","$rootScope","$filter","localStorageService","$translate","$routeParams",function(a,b,c,d,e,f){"use strict";var g=d.get("items"),h=function(a,b){try{return b?-1!==a.toLowerCase().indexOf(b.toLowerCase()):!0}catch(c){window.console&&window.console.error&&console.error(c,c.stack)}};a.items=g||[],a.language=e.use(),a.params=f,a.$on("reloadItems",function(){try{g=d.get("items"),a.items=g||[],a.search()}catch(b){window.console&&window.console.error&&console.error(b,b.stack)}}),a.changeLanguage=function(b){try{e.use(b),a.language=e.use()}catch(c){window.console&&window.console.error&&console.error(c,c.stack)}},a.topmenu=[{name:"MENU_FOCUS",value:"focus",icon:"all_out"},{name:"MENU_PROJECTS",value:"project",icon:"folder"},{name:"MENU_TASKS",value:"task",icon:"list"}],a.filters="focus",a.search=function(){try{b.filteredItems=c("filter")(a.items,function(b){return a.filters===b.type||"focus"===a.filters&&"0"===b.order&&"task"===b.type||""===a.filters&&h(b.title,a.query)?!0:!1}),"focus"!==a.filters?b.filteredItems=c("orderBy")(b.filteredItems,"order"):b.filteredItems=c("orderBy")(b.filteredItems,"date"),b.projectItems=c("filter")(a.items,function(a){return"project"===a.type?!0:!1})}catch(d){window.console&&window.console.error&&console.error(d,d.stack)}},a.search(),a.toggleFilters=function(b){try{a.filters=b,a.search()}catch(c){window.console&&window.console.error&&console.error(c,c.stack)}},b.global={search:""},a.toggleSearch=function(b){try{a.menuDiv.toggle(),a.searchDiv.toggle(),b?(a.filters=a.oldFilter,a.clearSearch()):(a.oldFilter=a.filters,a.filters="",a.searchInp.focus()),a.search()}catch(c){window.console&&window.console.error&&console.error(c,c.stack)}},a.clearSearch=function(){a.searchInp.val(""),b.global.search="",a.search()},$("document").ready(function(){a.menuDiv=$("#menuDiv"),a.searchDiv=$("#searchDiv"),a.searchInp=$("#searchInp");try{$.material.init()}catch(b){window.console&&window.console.error&&console.error(b,b.stack)}})}]),angular.module("nextmainfocusApp").run(["$templateCache",function(a){"use strict";a.put("views/main.html",'<ul class="well" ng-if="filters == \'focus\' || filters == \'\'"> <p class="list-itm-elem" ng-show="!filteredItems.length" translate>ITEMS_EMPTY</p> <li class="item-group" ng-repeat="item in filteredItems | filter: global.search"> <div class="item-itm-view lead"> <div class="list-itm-elem cursor" ng-click="editItem(item, item.index)" data-toggle="modal" data-target="#addNew"> <span class="item-title"> <span class="item-author" ng-show="item.type==\'task\'">{{item.acronym}}:</span> {{item.title}} <span class="item-author" ng-show="item.type==\'project\'">({{item.acronym}})</span> </span> <sapn class="text-muted" ng-if="item.date">{{item.date | asDate | date: \'dd.MM.yyyy\'}} <p class="item-author item-author-lnk" ng-show="item.type==\'task\'">{{item.details}}</p> </sapn></div> <div class="btn-group-sm item-remove-btn cursor"> <span class="btn btn-default btn-fab" ng-click="removeItemDialog(item.index)" data-toggle="modal" data-target="#confirmRemove"><i class="material-icons">close</i></span> <div class="tooltip right tooltip-link tooltip-link-remove" role="tooltip"> <div class="tooltip-inner">Remove</div> </div> </div> </div> </li> </ul> <ul class="well" ng-if="filters && filters != \'focus\' && !filteredItems.length"> <p class="list-itm-elem" ng-show="!filteredItems.length" translate>ITEMS_EMPTY</p> </ul> <ul class="well" ng-sortable="sortableItemList" ng-if="filters && filters != \'focus\' && filteredItems.length"> <li class="item-group" ng-repeat="item in filteredItems"> <div class="item-itm-view lead"> <div class="item-itm-tag"><i class="material-icons">reorder</i></div> <div class="list-itm-elem cursor" ng-click="editItem(item, item.index)" data-toggle="modal" data-target="#addNew"> <span class="item-title"> <span class="item-author" ng-show="item.type==\'task\'">{{item.acronym}}:</span> {{item.title}} <span class="item-author" ng-show="item.type==\'project\'">({{item.acronym}})</span> </span> <span class="text-muted" ng-if="item.date">{{item.date | asDate | date: \'dd.MM.yyyy\'}}</span> <p class="item-author item-author-lnk" ng-show="item.type==\'task\'">{{item.details}}</p> </div> <div class="btn-group-sm item-remove-btn cursor"> <span class="btn btn-default btn-fab" ng-click="removeItemDialog(item.index)" data-toggle="modal" data-target="#confirmRemove"><i class="material-icons">close</i></span> <div class="tooltip right tooltip-link tooltip-link-remove" role="tooltip"> <div class="tooltip-inner">Remove</div> </div> </div> </div> </li> </ul> <div class="add-btn-wrapper"> <div id="addBtn" class="add-btn"> <span class="btn btn-danger btn-fab btn-link" ng-click="newItem()" data-toggle="modal" data-target="#addNew"> <span class="add-btn-i"><i class="material-icons">add circle</i></span> </span> <div class="tooltip left tooltip-link" role="tooltip"> <div class="tooltip-inner">Add new</div> </div> </div> <div class="btn-group-sm hidden-sm hidden-xs"> <div class="btn-link-wrapper"> <span class="btn btn-success btn-fab btn-link-item" ng-click="newItem(true)" data-toggle="modal" data-target="#addNew"> <span class="add-btn-mini"><i class="material-icons">create_new_folder</i></span> </span> <div class="tooltip left tooltip-link tooltip-link-item" role="tooltip"> <div class="tooltip-inner">Add new project</div> </div> </div> <div class="btn-link-wrapper"> <span class="btn btn-info btn-fab btn-link-article" ng-click="newItem()" data-toggle="modal" data-target="#addNew"> <span class="add-btn-mini"><i class="material-icons">description</i></span> </span> <div class="tooltip left tooltip-link tooltip-link-article" role="tooltip"> <div class="tooltip-inner">Add new task</div> </div> </div> </div> </div> <div class="modal fade" id="addNew" role="dialog" data-keyboard="false"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-body"> <form ng-submit="saveEdits(item, \'submit\')"> <div id="itemTitleDiv" class="form-group label-floating" ng-class="{\'is-empty\': isEmpty}"> <label class="control-label" for="itemTitle" translate>ITEM_TITLE</label> <input class="form-control" id="itemTitle" type="text" ng-model="item.title" ng-trim="true" ng-maxlength="128" maxlength="128" required> <p class="help-block" id="itemTitleHelper" translate>ITEM_NOT_EMPTY</p> </div> <div id="itemAcronymDiv" class="form-group label-floating" ng-class="{\'is-empty\': isEmpty}" ng-show="item.type==\'project\'"> <label class="control-label" for="itemAcronym" translate>ITEM_ACRONYM</label> <input class="form-control" id="itemAcronym" type="text" ng-model="item.acronym" ng-trim="true" ng-maxlength="128" maxlength="128" required> <p class="help-block" translate>ITEM_NOT_EMPTY</p> </div> <div id="itemParentIdDiv" class="form-group label-floating" ng-show="item.type==\'task\'"> <label class="control-label" for="itemParentId" translate>ITEM_PARENTID</label> <select id="itemParentId" class="form-control" ng-model="item.parentID" ng-trim="true"> <option ng-select="item.parentID==option.index" ng-repeat="option in projectItems" value="{{option.index}}">{{option.title}}</option> <script></script> </select> </div> <div id="itemDateDiv" class="form-group label-floating" ng-class="{\'is-empty\': isEmpty}"> <label class="control-label" for="itemDate" translate>ITEM_DATE</label> <input class="form-control" id="itemDate" type="text" ng-model="item.date" ng-trim="true"> <i class="material-icons cursor item-date-btn" ng-click="clearDateInp()">close</i> </div> </form> </div> <div class="modal-footer"> <div class="togglebutton togglebutton-block"> <label> <span class="btn togglebutton-btn hidden-xs" ng-class="{\'btn-primary\': item.type!=\'project\'}">Project</span> <input ng-model="item.type" type="checkbox" ng-true-value="\'task\'" ng-false-value="\'project\'"> <span id="itemToggler" class="toggle"></span> <span class="btn togglebutton-btn hidden-xs" ng-class="{\'btn-primary\': item.type!=\'task\'}">Task</span> </label> </div> <button type="button" class="btn btn-default" ng-click="revertItem(item.index)" data-dismiss="modal" translate>ITEM_CLOSE</button> <button type="button" class="btn btn-primary" ng-click="saveEdits(item, item.index)" translate>ITEM_SAVE_CHANGES</button> </div> </div> <!-- /.modal-content --> </div> <!-- /.modal-dialog --> </div> <!-- /.modal --> <div class="modal fade" id="confirmRemove" role="dialog" data-keyboard="false"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-body"> <form ng-submit="removeItem(item.index)"> <p class="" id="confirmTitle" translate>CONFIRM_QUESTION</p> </form> </div> <div class="modal-footer"> <button type="button" class="btn btn-default" data-dismiss="modal" translate>ITEM_CLOSE</button> <button type="button" class="btn btn-primary" ng-click="removeItem(index)" translate>ITEM_REMOVE</button> </div> </div> <!-- /.modal-content --> </div> <!-- /.modal-dialog --> </div> <!-- /.modal -->')}]);